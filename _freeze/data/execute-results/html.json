{
  "hash": "a38d749bce5be725dbaba925b2e8e653",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"\"\n---\n\n\n# Organizing the data\n\n## Packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(gsheet)\nlibrary(tidyverse)\nlibrary(broom)\nlibrary(dplyr)\nlibrary(tidyr)\n```\n:::\n\n\n## Import Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf = gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1JAEAXsmb928CsyCzRbfTP2ilruEof2Qkr_zWUfaknOc/edit?gid=0#gid=0\")\n\ndf\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 3,708 × 28\n   Ensaio ensaio_1 pesquisador     ano n_aplicacao cultivar cultivo bioma\n    <dbl>    <dbl> <chr>         <dbl>       <dbl> <chr>    <chr>   <chr>\n 1      2        1 Marina Senger  2024          NA <NA>     <NA>    <NA> \n 2      2        1 Marina Senger  2024          NA <NA>     <NA>    <NA> \n 3      2        1 Marina Senger  2024          NA <NA>     <NA>    <NA> \n 4      2        1 Marina Senger  2024          NA <NA>     <NA>    <NA> \n 5      2        1 Marina Senger  2024          NA <NA>     <NA>    <NA> \n 6      2        1 Marina Senger  2024          NA <NA>     <NA>    <NA> \n 7      2        1 Marina Senger  2024          NA <NA>     <NA>    <NA> \n 8      2        1 Marina Senger  2024          NA <NA>     <NA>    <NA> \n 9      2        1 Marina Senger  2024          NA <NA>     <NA>    <NA> \n10      2        1 Marina Senger  2024          NA <NA>     <NA>    <NA> \n# ℹ 3,698 more rows\n# ℹ 20 more variables: municipio <chr>, regiao <chr>, estado <chr>,\n#   macrorregiao <chr>, mesorregiao <chr>, microrregiao <chr>,\n#   instituicao <chr>, `dose/ha` <chr>, registro <chr>, numero_registro <chr>,\n#   `concentração ia. no produto(%)` <chr>, codigo_frac <chr>, empresa <chr>,\n#   bloco <dbl>, produto <chr>, adjuvante <chr>, trat <dbl>, sev <dbl>,\n#   aacpd <dbl>, prod <dbl>\n```\n\n\n:::\n:::\n\n\n## Filtering the data\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Count in how many trials each product is present\nensaio_por_produto <- df %>%\n  group_by(produto) %>%\n  summarise(ensaio_count = n_distinct(ensaio_1))\n\n# Count how many years are present within each trial\nanos_por_ensaio <- df %>%\n  group_by(Ensaio) %>%\n  summarise(anos_count = n_distinct(ano))\n\n# Filter products with more than 19 trials\nprodutos_com_mais_de_19_ensaios <- ensaio_por_produto %>%\n  filter(ensaio_count > 19)\n\n# For these products, check in how many years they are present\nanos_por_produto <- df %>%\n  filter(produto %in% produtos_com_mais_de_19_ensaios$produto) %>%\n  group_by(produto) %>%\n  summarise(anos_count = n_distinct(ano))\n\n# Filter products present in at least 4 years\nprodutos_em_4_anos_ou_mais <- anos_por_produto %>%\n  filter(anos_count >= 4)\n\n# Filter data with these products #continue with the 79 as the control is present in all\ndf_filtrado <- df %>%\n  filter(produto %in% produtos_em_4_anos_ou_mais$produto)\n```\n:::\n\n\n### \n\n## Changing the name of the control\n\nThe control needs to be placed first so that the model can consider it as the intercept. Therefore, I added two A's at the beginning\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat1 <- df_filtrado %>%\n  group_by(municipio, bloco, ensaio_1, produto,ano, estado, regiao)  |> \n  mutate(produto = case_when(\n    produto == \"Testemunha (Controle Negativo)\" ~ \"AACHECK\",\n    produto == \"A20259\" ~ \"trat_A20259\",\n    TRUE ~ produto  # Mantém os demais valores inalterados\n  )) |>  \n   summarise(mean_sev = mean(sev),\n            mean_prod = mean(prod))\n```\n:::\n\n\n## Filtering again\n\nSome trials will contain only the control, making it impossible to compare with other treatments within the same trial (hence, ANOVA cannot be performed). Therefore, trials where the same number (repetition count) appears only 4 times should be removed.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndat1 <- dat1 %>%\n  group_by(ensaio_1) %>%\n  filter(n() > 4) %>%  \n  ungroup()\nunique(dat1$estado)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"GO\" \"PR\" \"MS\" \"SP\" \"MG\" \"DF\"\n```\n\n\n:::\n:::\n\n\n## Verifying some information\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Verifying the trials\ntratamentos_por_ensaio <- dat1 %>%\n  group_by(ensaio_1) %>%\n  summarise(\n    total_tratamentos = n_distinct(produto), # Count unique treatments\n    .groups = \"drop\"\n  )\n\n\ncontagem_por_produto <- dat1 %>%\n  group_by(produto) %>%\n  summarise(\n    total_ensaios = n_distinct(ensaio_1),  # Count unique trials\n    total_anos = n_distinct(ano),         # Count unique years\n    anos = paste(sort(unique(ano)), collapse = \", \"), # List sorted years\n    ensaios = paste(sort(unique(ensaio_1)), collapse = \", \"), # List unique trials\n    .groups = \"drop\"\n  )\n\nlibrary(writexl)\nwrite_xlsx(contagem_por_produto, \"contagem_por_produto_após_filtro.xlsx\")\nwrite_xlsx(dat1, \"dat1.xlsx\")\n```\n:::\n\n\n# Sampling variances\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsev <- dat1 %>% \n  filter(mean_sev != \"NA\") %>% \n  filter(mean_sev>0) \nhist(sev$mean_sev)\n```\n\n::: {.cell-output-display}\n![](data_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n\n```{.r .cell-code}\nsev2 = sev %>%\n  mutate(log_sev = log(mean_sev))\nhist(sev2$log_sev)\n```\n\n::: {.cell-output-display}\n![](data_files/figure-html/unnamed-chunk-7-2.png){width=672}\n:::\n\n```{.r .cell-code}\nlength(unique(sev$ensaio_1))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 78\n```\n\n\n:::\n\n```{.r .cell-code}\nyield <- dat1 %>% \n  filter(mean_prod != \"NA\")\nhist(yield$mean_prod)\n```\n\n::: {.cell-output-display}\n![](data_files/figure-html/unnamed-chunk-7-3.png){width=672}\n:::\n\n```{.r .cell-code}\np1 = ggplot(sev, aes(x = mean_sev)) +\n  geom_histogram(bins = 25, fill = \"#fc8d59\", color = \"black\") + \n labs(title = \"\",\n       x = expression(bold(\"MWS Severity (%)\")),\n       y = expression(bold(\"Frequency\"))) +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(hjust = 0.5, face = \"bold\", size = 14),\n    axis.title = element_text(size = 12),\n    axis.text = element_text(size = 10)\n  )\np2 = ggplot(sev2, aes(x = log_sev)) +\n  geom_histogram(fill = \"#91bfdb\", color = \"black\", bins = 25) + \n  labs(title = \"\",\n       x = expression(bold(\"MWS Severity (%)\")),\n       y = expression(bold(\"Frequency\"))) +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(hjust = 0.5, face = \"bold\", size = 14),\n    axis.title = element_text(size = 12),\n    axis.text = element_text(size = 10)\n  )\n\np3 = ggplot(yield, aes(x = mean_prod)) +\n  geom_histogram(fill = \"#91bfdb\", color = \"black\", bins = 25) + \n  labs(title = \"\",\n       x = expression(bold(\"Yield (kg ha\"^-1*\")\")) ,\n       y = expression(bold(\"Frequency\"))) +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(hjust = 0.5, face = \"bold\", size = 14),\n    axis.title = element_text(size = 12),\n    axis.text = element_text(size = 10)\n  )\n\nlibrary(patchwork)\n(p1/p2/p3)+ plot_annotation(tag_levels = 'A')\n```\n\n::: {.cell-output-display}\n![](data_files/figure-html/unnamed-chunk-7-4.png){width=672}\n:::\n\n```{.r .cell-code}\nggsave(\"distribution.png\", dpi=600, height = 8,bg = \"white\", width = 6\n       )\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}