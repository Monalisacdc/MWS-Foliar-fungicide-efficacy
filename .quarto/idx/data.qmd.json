{"title":"Organizing the data","markdown":{"yaml":{"title":""},"headingText":"Organizing the data","containsRefs":false,"markdown":"\n\n\n## Packages\n\n```{r}\n#| warning: false\n#| message: false\nlibrary(gsheet)\nlibrary(tidyverse)\nlibrary(broom)\nlibrary(dplyr)\nlibrary(tidyr)\n\n```\n\n## Import Data\n\n```{r}\ndf = gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1JAEAXsmb928CsyCzRbfTP2ilruEof2Qkr_zWUfaknOc/edit?gid=0#gid=0\")\n\ndf\n```\n\n## Filtering the data\n\n```{r}\n# Count in how many trials each product is present\nensaio_por_produto <- df %>%\n  group_by(produto) %>%\n  summarise(ensaio_count = n_distinct(ensaio_1))\n\n# Count how many years are present within each trial\nanos_por_ensaio <- df %>%\n  group_by(Ensaio) %>%\n  summarise(anos_count = n_distinct(ano))\n\n# Filter products with more than 19 trials\nprodutos_com_mais_de_19_ensaios <- ensaio_por_produto %>%\n  filter(ensaio_count > 19)\n\n# For these products, check in how many years they are present\nanos_por_produto <- df %>%\n  filter(produto %in% produtos_com_mais_de_19_ensaios$produto) %>%\n  group_by(produto) %>%\n  summarise(anos_count = n_distinct(ano))\n\n# Filter products present in at least 4 years\nprodutos_em_4_anos_ou_mais <- anos_por_produto %>%\n  filter(anos_count >= 4)\n\n# Filter data with these products #continue with the 79 as the control is present in all\ndf_filtrado <- df %>%\n  filter(produto %in% produtos_em_4_anos_ou_mais$produto)\n\n```\n\n### \n\n## Changing the name of the control\n\nThe control needs to be placed first so that the model can consider it as the intercept. Therefore, I added two A's at the beginning\n\n```{r}\ndat1 <- df_filtrado %>%\n  group_by(municipio, bloco, ensaio_1, produto,ano, estado, regiao)  |> \n  mutate(produto = case_when(\n    produto == \"Testemunha (Controle Negativo)\" ~ \"AACHECK\",\n    produto == \"A20259\" ~ \"trat_A20259\",\n    TRUE ~ produto  # Mantém os demais valores inalterados\n  )) |>  \n   summarise(mean_sev = mean(sev),\n            mean_prod = mean(prod))\n\n```\n\n## Filtering again\n\nSome trials will contain only the control, making it impossible to compare with other treatments within the same trial (hence, ANOVA cannot be performed). Therefore, trials where the same number (repetition count) appears only 4 times should be removed.\n\n```{r}\n\ndat1 <- dat1 %>%\n  group_by(ensaio_1) %>%\n  filter(n() > 4) %>%  \n  ungroup()\nunique(dat1$estado)\n\n\n```\n\n## Verifying some information\n\n```{r}\n\n# Verifying the trials\ntratamentos_por_ensaio <- dat1 %>%\n  group_by(ensaio_1) %>%\n  summarise(\n    total_tratamentos = n_distinct(produto), # Count unique treatments\n    .groups = \"drop\"\n  )\n\n\ncontagem_por_produto <- dat1 %>%\n  group_by(produto) %>%\n  summarise(\n    total_ensaios = n_distinct(ensaio_1),  # Count unique trials\n    total_anos = n_distinct(ano),         # Count unique years\n    anos = paste(sort(unique(ano)), collapse = \", \"), # List sorted years\n    ensaios = paste(sort(unique(ensaio_1)), collapse = \", \"), # List unique trials\n    .groups = \"drop\"\n  )\n\nlibrary(writexl)\nwrite_xlsx(contagem_por_produto, \"contagem_por_produto_após_filtro.xlsx\")\nwrite_xlsx(dat1, \"dat1.xlsx\")\n\n```\n\n# Sampling variances\n\n```{r}\nsev <- dat1 %>% \n  filter(mean_sev != \"NA\") %>% \n  filter(mean_sev>0) \nhist(sev$mean_sev)\n\n\n\nsev2 = sev %>%\n  mutate(log_sev = log(mean_sev))\nhist(sev2$log_sev)\n\nlength(unique(sev$ensaio_1))\n\nyield <- dat1 %>% \n  filter(mean_prod != \"NA\")\nhist(yield$mean_prod)\n\n\n\np1 = ggplot(sev, aes(x = mean_sev)) +\n  geom_histogram(bins = 25, fill = \"#fc8d59\", color = \"black\") + \n labs(title = \"\",\n       x = expression(bold(\"MWS Severity (%)\")),\n       y = expression(bold(\"Frequency\"))) +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(hjust = 0.5, face = \"bold\", size = 14),\n    axis.title = element_text(size = 12),\n    axis.text = element_text(size = 10)\n  )\np2 = ggplot(sev2, aes(x = log_sev)) +\n  geom_histogram(fill = \"#91bfdb\", color = \"black\", bins = 25) + \n  labs(title = \"\",\n       x = expression(bold(\"MWS Severity (%)\")),\n       y = expression(bold(\"Frequency\"))) +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(hjust = 0.5, face = \"bold\", size = 14),\n    axis.title = element_text(size = 12),\n    axis.text = element_text(size = 10)\n  )\n\np3 = ggplot(yield, aes(x = mean_prod)) +\n  geom_histogram(fill = \"#91bfdb\", color = \"black\", bins = 25) + \n  labs(title = \"\",\n       x = expression(bold(\"Yield (kg ha\"^-1*\")\")) ,\n       y = expression(bold(\"Frequency\"))) +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(hjust = 0.5, face = \"bold\", size = 14),\n    axis.title = element_text(size = 12),\n    axis.text = element_text(size = 10)\n  )\n\nlibrary(patchwork)\n(p1/p2/p3)+ plot_annotation(tag_levels = 'A')\nggsave(\"distribution.png\", dpi=600, height = 8,bg = \"white\", width = 6\n       )\n```\n","srcMarkdownNoYaml":"\n\n# Organizing the data\n\n## Packages\n\n```{r}\n#| warning: false\n#| message: false\nlibrary(gsheet)\nlibrary(tidyverse)\nlibrary(broom)\nlibrary(dplyr)\nlibrary(tidyr)\n\n```\n\n## Import Data\n\n```{r}\ndf = gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1JAEAXsmb928CsyCzRbfTP2ilruEof2Qkr_zWUfaknOc/edit?gid=0#gid=0\")\n\ndf\n```\n\n## Filtering the data\n\n```{r}\n# Count in how many trials each product is present\nensaio_por_produto <- df %>%\n  group_by(produto) %>%\n  summarise(ensaio_count = n_distinct(ensaio_1))\n\n# Count how many years are present within each trial\nanos_por_ensaio <- df %>%\n  group_by(Ensaio) %>%\n  summarise(anos_count = n_distinct(ano))\n\n# Filter products with more than 19 trials\nprodutos_com_mais_de_19_ensaios <- ensaio_por_produto %>%\n  filter(ensaio_count > 19)\n\n# For these products, check in how many years they are present\nanos_por_produto <- df %>%\n  filter(produto %in% produtos_com_mais_de_19_ensaios$produto) %>%\n  group_by(produto) %>%\n  summarise(anos_count = n_distinct(ano))\n\n# Filter products present in at least 4 years\nprodutos_em_4_anos_ou_mais <- anos_por_produto %>%\n  filter(anos_count >= 4)\n\n# Filter data with these products #continue with the 79 as the control is present in all\ndf_filtrado <- df %>%\n  filter(produto %in% produtos_em_4_anos_ou_mais$produto)\n\n```\n\n### \n\n## Changing the name of the control\n\nThe control needs to be placed first so that the model can consider it as the intercept. Therefore, I added two A's at the beginning\n\n```{r}\ndat1 <- df_filtrado %>%\n  group_by(municipio, bloco, ensaio_1, produto,ano, estado, regiao)  |> \n  mutate(produto = case_when(\n    produto == \"Testemunha (Controle Negativo)\" ~ \"AACHECK\",\n    produto == \"A20259\" ~ \"trat_A20259\",\n    TRUE ~ produto  # Mantém os demais valores inalterados\n  )) |>  \n   summarise(mean_sev = mean(sev),\n            mean_prod = mean(prod))\n\n```\n\n## Filtering again\n\nSome trials will contain only the control, making it impossible to compare with other treatments within the same trial (hence, ANOVA cannot be performed). Therefore, trials where the same number (repetition count) appears only 4 times should be removed.\n\n```{r}\n\ndat1 <- dat1 %>%\n  group_by(ensaio_1) %>%\n  filter(n() > 4) %>%  \n  ungroup()\nunique(dat1$estado)\n\n\n```\n\n## Verifying some information\n\n```{r}\n\n# Verifying the trials\ntratamentos_por_ensaio <- dat1 %>%\n  group_by(ensaio_1) %>%\n  summarise(\n    total_tratamentos = n_distinct(produto), # Count unique treatments\n    .groups = \"drop\"\n  )\n\n\ncontagem_por_produto <- dat1 %>%\n  group_by(produto) %>%\n  summarise(\n    total_ensaios = n_distinct(ensaio_1),  # Count unique trials\n    total_anos = n_distinct(ano),         # Count unique years\n    anos = paste(sort(unique(ano)), collapse = \", \"), # List sorted years\n    ensaios = paste(sort(unique(ensaio_1)), collapse = \", \"), # List unique trials\n    .groups = \"drop\"\n  )\n\nlibrary(writexl)\nwrite_xlsx(contagem_por_produto, \"contagem_por_produto_após_filtro.xlsx\")\nwrite_xlsx(dat1, \"dat1.xlsx\")\n\n```\n\n# Sampling variances\n\n```{r}\nsev <- dat1 %>% \n  filter(mean_sev != \"NA\") %>% \n  filter(mean_sev>0) \nhist(sev$mean_sev)\n\n\n\nsev2 = sev %>%\n  mutate(log_sev = log(mean_sev))\nhist(sev2$log_sev)\n\nlength(unique(sev$ensaio_1))\n\nyield <- dat1 %>% \n  filter(mean_prod != \"NA\")\nhist(yield$mean_prod)\n\n\n\np1 = ggplot(sev, aes(x = mean_sev)) +\n  geom_histogram(bins = 25, fill = \"#fc8d59\", color = \"black\") + \n labs(title = \"\",\n       x = expression(bold(\"MWS Severity (%)\")),\n       y = expression(bold(\"Frequency\"))) +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(hjust = 0.5, face = \"bold\", size = 14),\n    axis.title = element_text(size = 12),\n    axis.text = element_text(size = 10)\n  )\np2 = ggplot(sev2, aes(x = log_sev)) +\n  geom_histogram(fill = \"#91bfdb\", color = \"black\", bins = 25) + \n  labs(title = \"\",\n       x = expression(bold(\"MWS Severity (%)\")),\n       y = expression(bold(\"Frequency\"))) +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(hjust = 0.5, face = \"bold\", size = 14),\n    axis.title = element_text(size = 12),\n    axis.text = element_text(size = 10)\n  )\n\np3 = ggplot(yield, aes(x = mean_prod)) +\n  geom_histogram(fill = \"#91bfdb\", color = \"black\", bins = 25) + \n  labs(title = \"\",\n       x = expression(bold(\"Yield (kg ha\"^-1*\")\")) ,\n       y = expression(bold(\"Frequency\"))) +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(hjust = 0.5, face = \"bold\", size = 14),\n    axis.title = element_text(size = 12),\n    axis.text = element_text(size = 10)\n  )\n\nlibrary(patchwork)\n(p1/p2/p3)+ plot_annotation(tag_levels = 'A')\nggsave(\"distribution.png\", dpi=600, height = 8,bg = \"white\", width = 6\n       )\n```\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":true,"freeze":"auto","echo":true,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["styles.css"],"toc":true,"output-file":"data.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.4.555","editor":"visual","toc_depth":3,"toc_title":"Sumário","toc_float":{"collapsed":"no","smooth_scroll":"no"},"lib_dir":"site_libs","self_contained":"no","title":""},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}